(function(i,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(i=typeof globalThis<"u"?globalThis:i||self,r(i.highlightInput={},i.Vue))})(this,function(i,r){"use strict";const T=["innerHTML","onKeydown"],y={name:"HighlightInput"},S=r.defineComponent({...y,props:{modelValue:{type:String,default:""},keywords:{type:Array,default:[]},color:{type:String,default:"#F56C6C"}},emits:["update:modelValue"],setup(c,{emit:p}){const d=c,u=r.ref(""),s=r.ref();let m=!1;r.watch(()=>d.modelValue,n=>{A(n)});const B=n=>n.replace(/[\-\/\\\^\$\*\+\?\.\(\)\|\[\]\{\}]/g,"\\$&"),R=n=>{var e="";return n.length==0?"":(e=n.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/ /g,"&nbsp;"),e=e.replace(/\'/g,"&#39;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\n/g,"<br/>"),e)},E=n=>{var e="";return n.length==0?"":(e=n.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&nbsp;/g," "),e=e.replace(/&#39;/g,"'"),e=e.replace(/&quot;/g,'"'),e=e.replace(/<br\/>/g,`
`),e)},w=(n,e)=>{if(!n)return"";const t=new RegExp(e.map(l=>B(String(l).trim())).join("|"),"gi");return n.replace(/\t/g,"").replace(t,"	$&	").split(/\t/).map((l,a)=>a%2===0?l:`<span style="color: ${d.color}">${l}</span>`).join("")},A=async n=>{let e=g(s.value)+h,t=R(n);u.value=w(t,d.keywords),await r.nextTick(),O(s.value,e),h=0},g=n=>{var o;n.focus();let e=(o=document.getSelection())==null?void 0:o.getRangeAt(0),t=e==null?void 0:e.cloneRange();return t==null||t.selectNodeContents(n),t==null||t.setEnd(e==null?void 0:e.endContainer,e==null?void 0:e.endOffset),k(t.cloneContents())};function k(n){for(var e="",t=n.childNodes,o=0;o<t.length;o++){var l=t[o];l.nodeType===Node.TEXT_NODE?e+=l.textContent:l.nodeType===Node.ELEMENT_NODE&&(e+=x(l))}return e.length}function x(n){var e="";if(n.nodeName==="BR")return e+" ";for(var t=n.childNodes,o=0;o<t.length;o++){var l=t[o];l.nodeType===Node.TEXT_NODE?e+=l.textContent:l.nodeType===Node.ELEMENT_NODE&&(l.nodeName==="BR"?e+=" ":e+=x(l))}return e}const O=(n,e)=>{let t=getSelection(),o=v(s.value,{pos:e});o&&(o.collapse(!1),t==null||t.removeAllRanges(),t==null||t.addRange(o))},v=(n,e,t)=>{if(t||(t=document.createRange(),t.selectNode(n),t.setStart(n,0)),e.pos===0)t.setEnd(n,e.pos);else if(n&&e.pos>0)if(n.nodeType===Node.TEXT_NODE){let l=n.textContent||"";l.length<e.pos?e.pos-=l.length:(t.setEnd(n,e.pos),e.pos=0)}else if(n.nodeName==="BR")e.pos-=1,e.pos===0&&t.setEnd(n.nextSibling||n,0);else for(var o=0;o<n.childNodes.length&&(t=v(n.childNodes[o],e,t),e.pos!==0);o++);return t},H=()=>{m=!0},I=n=>{m=!1,N(n)},N=n=>{if(!m){let e=n.target.innerText;p("update:modelValue",E(e||""))}},M=n=>{if(!n.shiftKey){n.preventDefault();var e=window.getSelection(),t=e.getRangeAt(0);let a=t.endContainer,_=a.parentNode||s.value;if(g(s.value)===s.value.innerText.length){var o=document.createElement("br"),l=document.createElement("br");a.nodeName==="BR"?(_.insertBefore(o,a.nextSibling),_.insertBefore(l,a.nextSibling),t.setStartBefore(l),t.setEndBefore(l)):(t.insertNode(o),t.insertNode(l),t.setStartAfter(l),t.setEndAfter(l))}else{var o=document.createElement("br");a.nodeName==="BR"?(_.insertBefore(o,a.nextSibling),t.setStartBefore(o),t.setEndBefore(o)):(t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o))}}};let h=0;return r.onMounted(()=>{s.value.addEventListener("paste",n=>{if(n.preventDefault(),!n.clipboardData)return;const t=n.clipboardData.getData("text").replace(/\r/g,"");let o=g(s.value),l=s.value.innerText,a=l.substr(0,o)+t+l.substr(o);h=t.length,p("update:modelValue",E(a||""))})}),(n,e)=>(r.openBlock(),r.createElementBlock("div",{ref_key:"inputDom",ref:s,innerHTML:u.value,class:"highlight-input",onInput:N,onCompositionstart:H,onCompositionend:I,contenteditable:"true",onKeydown:r.withKeys(M,["enter"])},null,40,T))}}),b="",f=((c,p)=>{const d=c.__vccOpts||c;for(const[u,s]of p)d[u]=s;return d})(S,[["__scopeId","data-v-a2ad3b79"]]),C=[f],D={install(c){C.forEach(p=>{c.component(p.name,f)})}};i.HighlightInput=f,i.default=D,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
